# 要件書：位置情報を利用した天気予報アプリ

## 1. プロジェクト概要

### 1.1 目的
ユーザーの現在位置に基づいて翌日の天気予報を表示するAndroidアプリケーションを開発する。

### 1.2 スコープ
- ユーザーの位置情報を取得
- 位置情報に基づいた天気予報のAPI呼び出し
- 翌日の天気予報情報の表示（天気、位置、気温、降水量のみ）
- お気に入り地点の登録・管理機能
- ボトムナビゲーションによる画面切り替え

## 2. 機能要件

### 2.1 位置情報取得機能
- ユーザーの現在位置（緯度・経度）を取得する
- 位置情報へのアクセス許可を要求する機能
- 位置情報が無効の場合のエラーハンドリング

### 2.2 天気予報取得機能
- Open-Meteo APIを使用して天気予報データを取得
- 翌日（24時間後）の天気予報情報の処理
- API通信エラーのハンドリング

### 2.3 表示機能
**翌日の天気予報情報の表示（シンプル版）**
- 天気状態（晴れ、雨など）
- 位置情報（地名または緯度・経度）
- 気温（最高気温、最低気温）
- 降水量
- 最終更新日時の表示

### 2.4 お気に入り地点機能
**地点登録機能**
- 現在地追加ボタンで位置情報を取得
- ユーザーが手動で地点名を入力
- 最大5地点まで登録可能
- 重複地点の登録制限なし

**地点管理機能**
- カード形式での地点一覧表示
- ドラッグ&ドロップによる並び順変更
- 削除ボタンによる地点削除
- 地点タップで詳細画面へ遷移

**表示情報**
- 地点名（ユーザー入力）
- 天気状態アイコン
- 気温（最高・最低）
- 最終更新日時

**データ管理**
- ローカルストレージに保存
- 保存データ：地点名、緯度、経度、登録日時
- 画面表示時に全地点の天気情報を取得

## 3. 非機能要件

### 3.1 技術要件
- 開発言語：Kotlin
- UI：Jetpack Compose
- アーキテクチャ：MVVM
- API：Open-Meteo

### 3.2 パフォーマンス要件
- アプリ起動時の応答速度：3秒以内
- APIレスポンス待機時間：最大5秒
- オフライン時の適切なエラーメッセージ表示

### 3.3 セキュリティ要件
- 位置情報の取得はアプリ使用時のみ
- 個人情報の収集なし
- 最小限の権限要求

## 4. UI/UX要件

### 4.1 画面構成
**メイン画面（現在地天気）**
- 現在地の天気予報表示
- レスポンシブデザイン（異なる画面サイズに対応）
- シンプルで直感的なレイアウト

**お気に入り地点画面**
- 登録地点の一覧表示（カード形式）
- 現在地追加ボタン
- ドラッグ&ドロップ対応

**地点詳細画面**
- 選択した地点の詳細天気情報表示
- メイン画面と同様のレイアウト

**ナビゲーション**
- ボトムナビゲーション（現在地 / お気に入り）

### 4.2 UI要素
**メイン画面要素**
- 位置情報表示部分
- 天気状態アイコン
- 気温表示（最高/最低）
- 降水量表示
- 更新ボタン
- ローディングインジケーター
- エラーメッセージ表示領域

**お気に入り地点画面要素**
- 地点カード（地点名、天気アイコン、気温、更新日時）
- 現在地追加ボタン
- 削除ボタン（各カード）
- ドラッグハンドル
- 地点名入力ダイアログ

**共通要素**
- ボトムナビゲーションバー
- ローディングインジケーター
- エラーメッセージ表示

## 5. アーキテクチャ設計

### 5.1 MVVMコンポーネント

**Model：位置情報および天気データを処理**
- リポジトリパターンを採用
- 位置情報サービス
- Open-Meteo API通信サービス
- お気に入り地点データ管理（ローカルストレージ）

**ViewModel：**
- 位置情報と天気データのステート管理
- UI状態の管理（ローディング、エラー、データ表示）
- ビジネスロジックの実装
- お気に入り地点の状態管理（追加、削除、並び順変更）

**View：**
- Jetpack Composeを使用したUI実装
- UIイベントのViewModel転送
- ボトムナビゲーション実装
- ドラッグ&ドロップ操作対応

### 5.2 データフロー

**メイン画面（現在地）**
1. 位置情報の要求・取得
2. 取得した位置情報をViewModelに通知
3. ViewModelがModelを通じてAPIリクエストを実行
4. 取得したデータをViewModelで処理
5. 処理したデータをViewに反映

**お気に入り地点画面**
1. 画面表示時にローカルストレージから地点データ読み込み
2. 各地点の天気情報をAPI経由で並列取得
3. 地点追加時：現在地取得→地点名入力→ローカル保存
4. 地点削除時：ローカルストレージから削除
5. 並び順変更時：新しい順序をローカル保存

## 6. 利用API

### 6.1 Open-Meteo API
- **エンドポイント：** https://api.open-meteo.com/v1/forecast
- **主要パラメータ：**
  - latitude：緯度
  - longitude：経度
  - daily：取得する天気情報（天気状態、気温、降水量）
  - timezone：タイムゾーン情報
  - forecast_days：予報日数（1日分）

### 6.2 位置情報API
- Android FusedLocationProviderClientを使用
- **設定：**
  - 精度：高精度
  - 更新間隔：アプリ起動時のみ

## 7. 課題と制約

### 7.1 検討事項
- API呼び出し回数の制限と対策
- 位置情報取得精度の最適化

### 7.2 制約事項
- アプリは縦向き表示のみ対応
- 位置情報の権限は実行時に要求
- お気に入り地点は最大5個まで
- 地点名は手動入力（将来的に自動取得を検討）
- 重複地点の登録制限なし

## 8. 将来的な拡張予定

### 8.1 お気に入り地点機能の拡張
- 地図選択による地点登録
- 緯度経度からの自動地点名取得
- クラウド同期機能
- 登録上限の拡張

### 8.2 その他機能拡張
- 週間天気予報表示
- 天気アラート機能
- ウィジェット対応